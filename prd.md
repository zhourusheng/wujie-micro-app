# 微前端项目需求文档

大型前端应用拆分成微前端架构是一项需要精心设计的工作。在我们的项目中，我们遵循了一系列拆分规则，这些规则帮助我们成功地将一个超过 20 万行代码的巨石应用拆分成了 7 个独立、高效的子应用。

## 一、业务领域拆分方案

#### 基于业务领域的垂直拆分

我们首先采用了领域驱动设计(DDD)的思想，基于业务领域进行垂直切分：

```
原单体应用
├── 用户管理模块
│   ├── 用户列表
│   ├── 用户详情
│   └── 权限管理
├── 订单管理模块
│   ├── 订单列表
│   ├── 订单详情
│   └── 订单统计
└── 商品管理模块
    ├── 商品列表
    ├── 商品编辑
    └── 库存管理
```

拆分后：

```
微前端基座应用
├── 用户管理子应用（领域1）
├── 订单管理子应用（领域2）
└── 商品管理子应用（领域3）
```

核心规则是：**按照业务领域的边界进行拆分，使每个子应用具有相对独立的业务价值和完整的功能链路**。

## 二、基于wujie的微前端架构设计

### 1. 整体架构设计

基于wujie微前端框架，我们的系统将构建为一个企业级电商管理平台，包含以下子应用：

```
wujie微前端基座（主应用）
├── 用户中心子应用（Vue3 + TypeScript）
├── 商品管理子应用（React18）
├── 订单系统子应用（Vue2） 
├── 数据分析子应用（Angular）
├── 营销活动子应用（React17）
├── 库存管理子应用（Vue3）
└── 系统设置子应用（Vue3）
```

### 2. 技术栈选型

- **基座应用**：Vue3 + TypeScript + Vite + Pinia
- **子应用**：允许使用不同技术栈，实现技术栈无关性
- **微前端框架**：无界wujie
- **UI组件库**：基座统一使用Ant Design Vue，子应用可自由选择
- **构建工具**：Vite/Webpack 5
- **包管理工具**：pnpm，采用Monorepo管理模式

### 3. 核心功能需求

#### 3.1 基座应用功能

- **统一认证中心**：实现SSO单点登录，统一管理用户身份与权限
- **全局状态管理**：使用Pinia管理全局共享状态
- **统一路由系统**：集中管理所有子应用路由，支持路由级别权限控制
- **全局UI框架**：提供统一的布局、导航、主题和基础组件
- **预加载策略**：支持子应用预加载，提升页面切换性能
- **全局异常处理**：统一的错误边界和异常处理机制

#### 3.2 子应用功能与特点

##### 用户中心子应用：
- 用户管理、权限配置、角色设定
- 行为审计、登录日志、操作历史

##### 商品管理子应用：
- 商品信息管理、SKU管理、类目管理
- 商品上下架、批量导入导出、图片管理

##### 订单系统子应用：
- 订单处理、订单状态跟踪、退换货管理
- 发票管理、物流跟踪、批量操作

##### 数据分析子应用：
- 销售数据可视化、用户行为分析
- 实时监控、定制报表、数据导出

##### 营销活动子应用：
- 促销活动管理、优惠券管理、限时活动
- A/B测试、活动效果分析

##### 库存管理子应用：
- 库存监控、入库出库管理、库存预警
- 供应商管理、采购计划、库存报表

##### 系统设置子应用：
- 全局配置、数据字典、参数设置
- 系统日志、备份恢复、系统监控

### 4. wujie特性应用需求

#### 4.1 应用隔离与沙箱

- **JS沙箱隔离**：确保各子应用JS运行环境相互隔离，避免全局变量污染
- **样式隔离**：采用shadow DOM实现CSS隔离，防止样式冲突
- **生命周期管理**：统一管理子应用的加载、挂载、卸载等生命周期

#### 4.2 应用通信机制

- **基座与子应用通信**：通过props传递、事件总线、发布订阅模式实现
- **子应用间通信**：使用wujie提供的通信API，实现子应用间数据共享与事件触发
- **全局状态共享**：核心共享数据统一存储在基座应用，按需分发给子应用

```
通信类型设计：
- 命令型：执行特定操作
- 数据型：传递或请求数据
- 询问型：查询状态信息
- 广播型：向多个子应用发送通知
```

#### 4.3 资源共享与复用

- **公共库共享**：将React、Vue等公共库提取为externals，实现多应用间共享
- **组件复用**：开发公共组件库，子应用通过npm依赖方式引入
- **工具函数共享**：提供统一的工具函数库，避免重复实现

#### 4.4 性能优化需求

- **预加载策略**：配置预加载子应用，减少首次加载时间
- **资源缓存**：缓存子应用静态资源，优化重复访问性能
- **按需加载**：子应用内部实现路由级别的代码分割和懒加载
- **请求合并与缓存**：实现API请求合并与结果缓存机制

### 5. 部署与发布策略

- **独立CI/CD流程**：各子应用拥有独立的构建与发布流程
- **增量部署**：支持子应用独立更新，不影响其他应用
- **环境隔离**：开发、测试、生产环境配置分离
- **灰度发布**：支持子应用按比例灰度发布能力

### 6. 监控与运维需求

- **性能监控**：记录并分析各子应用加载性能、运行状态
- **错误收集**：统一的前端错误日志收集与分析系统
- **用户行为跟踪**：收集用户操作路径与停留时间
- **健康检查**：子应用定期健康检查，确保稳定运行

## 三、项目实施计划

### 阶段一：基础设施搭建（1个月）
- 搭建基座应用基础框架
- 实现微前端核心加载机制
- 完成公共组件库初版开发

### 阶段二：核心子应用开发（2个月）
- 完成用户中心、商品管理和订单系统三个核心子应用
- 实现基础业务流程贯通

### 阶段三：完善应用生态（2个月）
- 开发剩余子应用
- 优化应用间通信与性能
- 完善监控与运维体系

### 阶段四：集成测试与上线（1个月）
- 全链路测试与问题修复
- 生产环境部署与验证
- 灰度发布与全量上线

## 四、技术风险与应对策略

1. **子应用加载失败风险**：实现失败重试与降级显示机制
2. **浏览器兼容性问题**：明确支持的浏览器版本范围，实施针对性兼容
3. **性能问题**：建立性能基线，定期性能评估与优化
4. **应用通信复杂度**：设计简洁通信协议，避免复杂依赖关系